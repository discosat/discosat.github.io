<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System setup &mdash; Discosat 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=2709fde1"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Image Processing Pipeline" href="image-processing-pipeline.html" />
    <link rel="prev" title="Software" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Discosat
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Disco 2</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../terms-and-abbreviations.html">Terms and Abbreviations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Software</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">System setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#serial-connection-to-the-com">Serial connection to the CoM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flash-the-system-image-onto-the-payload-com">Flash the system image onto the payload CoM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-to-can-peripherals-on-the-picocorebbdsi-baseboard">Connecting to CAN peripherals on the PicoCoreBBDSI baseboard</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="image-processing-pipeline.html">Image Processing Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="camera-controller.html">Camera Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="app-sys-manager.html">Application/System manager (Linux system calls over CSP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="cortex-m7.html">Cortex-M7 (low-power core)</a></li>
<li class="toctree-l3"><a class="reference internal" href="flight-planning-csp-proc.html">Flight planning (<cite>csp_proc</cite>)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Discosat</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Disco 2</a></li>
          <li class="breadcrumb-item"><a href="index.html">Software</a></li>
      <li class="breadcrumb-item active">System setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/disco-2/software/system-setup.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="system-setup">
<h1>System setup<a class="headerlink" href="#system-setup" title="Link to this heading"></a></h1>
<p>The camera control software, image processing pipeline and scheduler run on a <a class="reference external" href="https://fs-net.de/en/embedded-modules/computer-on-module-picocore/picocoremx8mp-nxp-imx8m-plus-cpu/">PicoCore™MX8MP</a> computer on module (CoM). The source code and build setup as well as <a class="reference external" href="https://github.com/discosat/disco-ii-picocore-mx8mp-yocto/releases/tag/image-files">compiled binaries</a> for the system image etc. are available on <a class="reference external" href="https://github.com/discosat/disco-ii-picocore-mx8mp-yocto">https://github.com/discosat/disco-ii-picocore-mx8mp-yocto</a>.</p>
<section id="serial-connection-to-the-com">
<h2>Serial connection to the CoM<a class="headerlink" href="#serial-connection-to-the-com" title="Link to this heading"></a></h2>
<p>To access the bootloader and/or Linux command line, you must establish a serial connection with a baud rate of 115200 to the board over UART_A. This can be done by connecting a USB to Serial UART adapter to your laptop (such as a FT232RL breakout board) and attaching the TX, RX and GND pins to the following pins on the J9 connector of the PicoCoreBBDSI baseboard:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-center"><p>J9 pin</p></th>
<th class="head text-center"><p>USB &lt;-&gt; Serial UART</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>3</p></td>
<td class="text-center"><p>TX</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>5</p></td>
<td class="text-center"><p>RX</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>9</p></td>
<td class="text-center"><p>GND</p></td>
</tr>
</tbody>
</table>
<p><img alt="PicoCoreBBDSI connector layout" src="../../_images/picocore-bbdsi-connector-layout.jpg" />
<em>Connector layout of the baseboard. Pin 1 is marked with a small red arrow. Source: <a class="reference external" href="https://fs-net.de/filelicence/get?fileid=11717&amp;amp;locale=en_US">F&amp;S Embedded Baseboard Hardware Documentation</a></em></p>
<p>Or alternatively connecting TX, RX and GND to the following pins on the (…) connector of the custom DISCO II PCB: <em>(TODO once PCB is finalized…)</em></p>
<p>You can then open a serial connection from your computer to the CoM to access U-Boot/Linux. E.g. if you’re running Linux and the USB to Serial adapter is exposed on device file <code class="docutils literal notranslate"><span class="pre">/dev/ttyUSB0</span></code>, you can run <code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">/dev/ttyUSB0</span> <span class="pre">115200</span></code> to open the connection - and there are many other alternatives to <code class="docutils literal notranslate"><span class="pre">screen</span></code> as well if you prefer to use a different utility. You may need to run something like <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">666</span> <span class="pre">/dev/ttyUSB0</span></code> first to avoid permission errors.</p>
<p>The system auto-boots into Linux, but if you’ve ended up in U-Boot, you can run <code class="docutils literal notranslate"><span class="pre">boot</span></code> to boot up the Linux kernel, after which you can log into the <code class="docutils literal notranslate"><span class="pre">root</span></code> user (with no password).</p>
<section id="uart-device-mapping">
<h3>UART device mapping<a class="headerlink" href="#uart-device-mapping" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Device file</p></th>
<th class="head"><p>UART name</p></th>
<th class="head"><p>Device tree name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Cortex-M7 debug</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/dev/ttymxc0</span></code></p></td>
<td><p>UART_C</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uart1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>U-Boot &amp; Linux command line</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/dev/ttymxc1</span></code></p></td>
<td><p>UART_A</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uart2</span></code></p></td>
</tr>
<tr class="row-even"><td><p>-</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/dev/ttymxc2</span></code></p></td>
<td><p>UART_D</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uart3</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>RS485 / CSP KISS interface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/dev/ttymxc3</span></code></p></td>
<td><p>UART_B</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uart4</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="flash-the-system-image-onto-the-payload-com">
<h2>Flash the system image onto the payload CoM<a class="headerlink" href="#flash-the-system-image-onto-the-payload-com" title="Link to this heading"></a></h2>
<p>Download or follow the instructions in the <a class="reference external" href="https://github.com/discosat/disco-ii-picocore-mx8mp-yocto">discosat/disco-ii-picocore-mx8mp-yocto</a> repository to build the system image and related files. The resulting files are packaged in a way that are easily flashed onto the CoM by cleverly utilizing the default U-Boot setup on the CoM. Simply move these files to the root directory of a portable storage medium like a USB flash drive or an SD card and plug it into the CoM. After this, power on the CoM and you should eventually see something similar to the following being transmitted on UART_A:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Loading /update.scr ... done!
Loaded!
switch to partitions #0, OK
mmc2(part 0) is current device
Loading /emmc-fsimx8mp.sysimg ... done!
14680064 bytes read in 515 ms (27.2 MiB/s)

MMC write: dev # 2, block # 0, count 28672 ... 28672 blocks written: OK
Loading /emmc-fsimx8mp.sysimg ... done!
14680064 bytes read in 518 ms (27 MiB/s)

(...)

MMC write: dev # 2, block # 2924544, count 20628 ... 20628 blocks written: OK
Configuring Cortex-M7 core boot
Saving Environment to MMC... Writing to MMC(2)... OK
Installation complete

---- update COMPLETE! ----
</pre></div>
</div>
<p>After this, everything is good to go 🚀 You can then run the <code class="docutils literal notranslate"><span class="pre">boot</span></code> command in U-Boot, which boots up the auxiliary Cortex-M7 core and starts the linux kernel. See also the <a class="reference internal" href="app-sys-manager.html#payload-nodes-in-the-csp-network"><span class="std std-ref">app-sys-manager</span></a> page for an overview of the CSP nodes that are in this system.</p>
</section>
<section id="connecting-to-can-peripherals-on-the-picocorebbdsi-baseboard">
<h2>Connecting to CAN peripherals on the PicoCoreBBDSI baseboard<a class="headerlink" href="#connecting-to-can-peripherals-on-the-picocorebbdsi-baseboard" title="Link to this heading"></a></h2>
<p>We are using 2 separate CAN peripherals on the PicoCoreMX8MP. CAN_A is used for the Cortex-M7 core while CAN_B is used for the Cortex-A53 cores and all applications running in Linux (camera control, image processing, app-sys-manager).</p>
<p>CAN_A exposes CAN Low and CAN High bus lines directly <a class="reference external" href="https://fs-net.de/filelicence/get?fileid=11717&amp;amp;locale=en_US">on pins 3 and 4 respectively on the J7 connector</a>. These can be connected directly the bus lines of an existing CAN network.</p>
<p>We use <a class="reference external" href="https://www.nxp.com/design/design-center/development-boards-and-designs/i-mx-evaluation-and-development-boards/config-tools-for-i-mx-applications-processors:CONFIG-TOOLS-IMX">pin multiplexing</a> for CAN_B. In other words, we map the pins that normally expose I2C_A_SCL and I2C_A_SDA on the J11 feature connector to CAN_B_TX and CAN_B_RX respectively. The possible pin multiplexing options of the PicoCoreMX8MP can be seen in this document: <a class="reference external" href="https://www.fs-net.de/filelicence/get?fileid=15656&amp;amp;locale=en_US">F&amp;S Embedded PicoCore™MX8MP Hardware Documentation</a> - See Table 6 specifically. CAN_B_RX and CAN_B_TX can then be connected to an external CAN transceiver to interface with the CAN network - at DASYA, we’ve been using an <a class="reference external" href="https://ww1.microchip.com/downloads/aemDocuments/documents/APID/ProductDocuments/DataSheets/20001667G.pdf">MCP2551</a> for our small lab setup.</p>
<p><img alt="PicoCoreBBDSI connector layout" src="../../_images/20240619_100642-min.jpg" />
<em>Connection between PicoCoreBBDSI baseboard and MCP2551 CAN transceiver</em></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="image-processing-pipeline.html" class="btn btn-neutral float-right" title="Image Processing Pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Discosat.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>